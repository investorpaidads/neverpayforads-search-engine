// src/pages/api/binLookup.ts
import type { NextApiRequest, NextApiResponse } from "next";
import { getBankLogo } from "@/lib/bank-logos";

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const { bin } = req.query;
  if (!bin || typeof bin !== "string") return res.status(400).json({ logo: null });

  try {
    const response = await fetch(`https://lookup.binlist.net/${bin}`, { cache: "no-store" });
    if (!response.ok) return res.status(200).json({ logo: null });

    const data: any = await response.json();

    if (data?.bank?.logo) return res.status(200).json({ logo: data.bank.logo });
    if (data?.bank?.name) return res.status(200).json({ logo: getBankLogo(data.bank.name, null) });

    return res.status(200).json({ logo: null });
  } catch (err) {
    console.error("BIN Lookup API error:", err);
    return res.status(500).json({ logo: null });
  }
}
